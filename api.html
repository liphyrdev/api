<!DOCTYPE html>
<html>
<head>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white; 
            font-family: monospace;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container { 
            max-width: 800px; 
            width: 100%;
            text-align: center;
        }
        
        .protected-view {
            padding: 40px 20px;
        }
        .protected-view h1 {
            color: #ff0000;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ff0000;
        }
        .loader-code {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            font-family: monospace;
            color: #00ff88;
            border: 2px solid #00ff88;
            word-break: break-all;
        }
        .status {
            color: #ff9900;
            margin: 20px 0;
            font-size: 1.2rem;
        }
        .footer {
            color: #888;
            margin-top: 30px;
            font-size: 0.9rem;
        }
        code {
            display: block;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 1.1rem;
            border: 1px solid #444;
        }
    </style>
    <script>
        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCMxnBTU9Z2lPzVia4tToyF_dKF2sS6DZ0",
            authDomain: "api-lol-guard-2f615.firebaseapp.com",
            databaseURL: "https://api-lol-guard-2f615-default-rtdb.firebaseio.com",
            projectId: "api-lol-guard-2f615",
            storageBucket: "api-lol-guard-2f615.firebasestorage.app",
            messagingSenderId: "745922329728",
            appId: "1:745922329728:web:74f66432e344db789cfa65"
        };
        
        // Inicializar Firebase (mas n√£o vamos usar database.ref)
        firebase.initializeApp(firebaseConfig);
        
        // Detectar se √© Roblox - L√ìGICA SIMPLIFICADA
        function isRobloxRequest() {
            // Se o User-Agent cont√©m "Roblox" ou tem par√¢metro ?roblox=true
            return navigator.userAgent.includes('Roblox') || 
                   window.location.search.includes('roblox=true');
        }
        
        // Buscar script do Firebase - M√âTODO CORRETO
        async function getScript() {
            const urlParams = new URLSearchParams(window.location.search);
            const scriptId = urlParams.get('id');
            
            if (!scriptId) {
                showProtectedPage("‚ö†Ô∏è Nenhum ID fornecido");
                return;
            }
            
            // URL DIRETA do Firebase - MESMO FORMATO que seu site principal
            const firebaseUrl = `https://api-lol-guard-2f615-default-rtdb.firebaseio.com/scripts/${scriptId}.json`;
            
            try {
                const response = await fetch(firebaseUrl);
                
                if (!response.ok) {
                    showProtectedPage("‚ùå Script n√£o encontrado no Firebase");
                    return;
                }
                
                const scriptData = await response.json();
                
                if (!scriptData || !scriptData.content) {
                    showProtectedPage("‚ö†Ô∏è Script sem conte√∫do");
                    return;
                }
                
                // SE FOR ROBLOX ‚Üí Retorna APENAS o c√≥digo Lua PURO
                if (isRobloxRequest()) {
                    // Remove TODO o HTML e coloca apenas o script
                    document.body.innerHTML = '';
                    // textContent mant√©m o c√≥digo limpo
                    document.body.textContent = scriptData.content;
                } 
                // SE FOR NAVEGADOR ‚Üí Mostra mensagem protegida
                else {
                    showProtectedPage(
                        `‚úÖ Script encontrado: ${scriptData.name || scriptId}`,
                        scriptData.content.length
                    );
                }
                
            } catch (error) {
                console.error('Erro Firebase:', error);
                showProtectedPage("üî• Erro ao conectar com Firebase");
            }
        }
        
        // Mostrar p√°gina protegida COMPLETA
        function showProtectedPage(message = '', scriptLength = 0) {
            const currentUrl = window.location.href;
            
            document.body.innerHTML = '';
            document.body.innerHTML = `
                <div class="container">
                    <div class="protected-view">
                        <h1>üîí SCRIPT PROTEGIDO POR LOL GUARD</h1>
                        <p>Este script est√° protegido pelo sistema LOL GUARD.</p>
                        <p>O acesso direto ao c√≥digo √© bloqueado.</p>
                        
                        ${message ? `<div class="status">${message}</div>` : ''}
                        
                        ${scriptLength ? `
                            <div style="margin: 20px 0; color: #00ccff;">
                                üìè Tamanho: ${scriptLength} caracteres
                            </div>
                        ` : ''}
                        
                        <div class="loader-code">
                            <p>Para usar este script no Roblox Executor:</p>
                            <code>loadstring(game:HttpGet("${currentUrl}"))()</code>
                            <p style="margin-top: 15px; color: #aaa; font-size: 0.9rem;">
                                Cole este c√≥digo no executor do Roblox
                            </p>
                        </div>
                        
                        <div class="footer">
                            Sistema de prote√ß√£o LOL GUARD v2.0 | API Intermedi√°ria
                            <br>
                            <span style="color: #666; font-size: 0.8rem;">
                                ID detectado: ${new URLSearchParams(window.location.search).get('id') || 'Nenhum'}
                            </span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Iniciar - L√ìGICA CORRIGIDA
        window.onload = function() {
            // Se a p√°gina j√° tem conte√∫do (provavelmente j√° processou para Roblox), n√£o faz nada
            if (document.body.textContent.includes('print') || 
                document.body.textContent.includes('local') ||
                document.body.textContent.includes('game:')) {
                console.log('J√° retornando script para Roblox');
                return;
            }
            
            // Se N√ÉO for Roblox, mostra p√°gina protegida
            if (!isRobloxRequest()) {
                // Primeiro mostra p√°gina protegida gen√©rica
                showProtectedPage("üîç Verificando script no Firebase...");
                // Depois busca no Firebase
                setTimeout(() => getScript(), 500);
            } else {
                // Se FOR Roblox, busca direto
                getScript();
            }
        };
    </script>
</head>
<body>
    <!-- Conte√∫do ser√° carregado dinamicamente -->
    <div style="padding: 50px; text-align: center;">
        <h2>LOL GUARD API</h2>
        <p>Carregando sistema de prote√ß√£o...</p>
    </div>
</body>
</html>
